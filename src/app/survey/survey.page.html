<ion-content>
    <div class="ion-padding">
        <ion-card class="survey-card">
            <ion-card-header class="ion-text-center">
                <ion-icon name="clipboard-outline" style="font-size: 48px; color: var(--ion-color-primary)"></ion-icon>
                <ion-card-title class="ion-margin-top">Feedback Survey</ion-card-title>
                <ion-card-subtitle>Help us improve with your feedback</ion-card-subtitle>
            </ion-card-header>

            <ion-card-content class="ion-padding">
                <form #surveyForm="ngForm" (ngSubmit)="submit(surveyForm)" class="survey-form">

                    <div class="form-group">
                        <ion-item [class.ion-invalid]="submitted && !form.fullName" lines="none">
                            <div class="input-wrapper">
                                <ion-label class="field-label">Full Name *</ion-label>
                                <ion-input #fullNameInput="ngModel" name="fullName" required minlength="2"
                                    [(ngModel)]="form.fullName" (ionInput)="onInputChange(fullNameInput, 'fullName')"
                                    placeholder="Enter your full name" class="custom-input" fill="solid"
                                    aria-label="Full Name">
                                </ion-input>
                            </div>
                        </ion-item>
                    </div>
                    <div class="validation-wrapper">
                        <div *ngIf="(submitted || fullNameInput.dirty) && fullNameInput.errors?.['required']"
                            class="validation">
                            Full Name is required
                        </div>
                        <div *ngIf="(submitted || fullNameInput.dirty) && fullNameInput.errors?.['minlength']"
                            class="validation">
                            Full Name must be at least 2 characters
                        </div>
                        <div *ngIf="!fullNameInput.errors && fullNameInput.dirty" class="validation-success">
                            <ion-icon name="checkmark-circle"></ion-icon> Looks good!
                        </div>
                    </div>

                    <ion-item [class.ion-invalid]="submitted && contactError">
                        <ion-label position="floating">Email Address *</ion-label>
                        <ion-input #emailInput="ngModel" name="contact" type="email" [(ngModel)]="form.contact" required
                            email (ionInput)="onInputChange(emailInput, 'email')" aria-label="Email" inputmode="email">
                        </ion-input>
                    </ion-item>
                    <div class="validation-wrapper">
                        <div *ngIf="(submitted || emailInput.dirty) && emailInput.errors?.['required']"
                            class="validation">
                            Email address is required
                        </div>
                        <div *ngIf="(submitted || emailInput.dirty) && emailInput.errors?.['email']" class="validation">
                            Please enter a valid email address (e.g., name@example.com)
                        </div>
                        <div *ngIf="!emailInput.errors && emailInput.dirty" class="validation-success">
                            <ion-icon name="checkmark-circle"></ion-icon> Valid email format
                        </div>
                    </div>

                    <div class="form-group">
                        <ion-label class="section-label">Rating / Satisfaction Level *</ion-label>
                        <div class="radio-container">
                            <ion-radio-group #ratingInput="ngModel" name="rating" [(ngModel)]="form.rating" required
                                (ionChange)="onInputChange(ratingInput, 'rating')">
                                <ion-item lines="none">
                                    <ion-radio slot="start" value="5"></ion-radio>
                                    <ion-label>Very Satisfied</ion-label>
                                </ion-item>
                                <ion-item lines="none">
                                    <ion-radio slot="start" value="4"></ion-radio>
                                    <ion-label>Satisfied</ion-label>
                                </ion-item>
                                <ion-item lines="none">
                                    <ion-radio slot="start" value="3"></ion-radio>
                                    <ion-label>Neutral</ion-label>
                                </ion-item>
                                <ion-item lines="none">
                                    <ion-radio slot="start" value="2"></ion-radio>
                                    <ion-label>Dissatisfied</ion-label>
                                </ion-item>
                                <ion-item lines="none">
                                    <ion-radio slot="start" value="1"></ion-radio>
                                    <ion-label>Very Dissatisfied</ion-label>
                                </ion-item>
                            </ion-radio-group>
                        </div>
                    </div>
                    <div class="validation-wrapper">
                        <div *ngIf="(submitted || ratingInput.dirty) && ratingInput.errors?.['required']"
                            class="validation">
                            Please select your satisfaction level
                        </div>
                        <div *ngIf="!ratingInput.errors && ratingInput.dirty" class="validation-success">
                            <ion-icon name="checkmark-circle"></ion-icon> Rating selected
                        </div>
                    </div>

                    <ion-item>
                        <ion-label position="floating">Comments / Feedback</ion-label>
                        <ion-textarea #commentsInput="ngModel" name="comments" [(ngModel)]="form.comments"
                            maxlength="500" rows="4" (ionInput)="onInputChange(commentsInput, 'comments')"
                            aria-label="Comments">
                        </ion-textarea>
                    </ion-item>
                    <div class="validation-wrapper" *ngIf="commentsInput.dirty">
                        <div class="helper-text">
                            {{500 - (form.comments.length || 0)}} characters remaining
                        </div>
                    </div>

                    <ion-item [class.ion-invalid]="submitted && !form.datetime">
                        <ion-label position="floating">Date & Time *</ion-label>
                        <ion-datetime #datetimeInput="ngModel" name="datetime" display-format="MMM DD, YYYY HH:mm"
                            picker-format="MMM DD YYYY HH:mm" [(ngModel)]="form.datetime" required
                            (ionChange)="onInputChange(datetimeInput, 'datetime')">
                        </ion-datetime>
                    </ion-item>
                    <div class="validation-wrapper">
                        <div *ngIf="(submitted || datetimeInput.dirty) && datetimeInput.errors?.['required']"
                            class="validation">
                            Please select date and time
                        </div>
                        <div *ngIf="!datetimeInput.errors && datetimeInput.dirty" class="validation-success">
                            <ion-icon name="checkmark-circle"></ion-icon> Date and time selected
                        </div>
                    </div>

                    <ion-item class="feature-item">
                        <ion-label>
                            <h2>Location</h2>
                            <p *ngIf="latitude !== null && longitude !== null">Lat: {{latitude}} , Lng: {{longitude}}
                            </p>
                            <p *ngIf="latitude === null" class="ion-text-wrap">No location captured - tap button to get
                                your current location</p>
                        </ion-label>
                        <ion-button slot="end" (click)="getLocation()" [disabled]="gettingLocation"
                            class="location-button">
                            <ion-spinner *ngIf="gettingLocation" name="dots" slot="start"></ion-spinner>
                            <ion-icon *ngIf="!gettingLocation" name="location-outline" slot="start"></ion-icon>
                            <span *ngIf="!gettingLocation">Get Location</span>
                        </ion-button>
                    </ion-item>
                    <div *ngIf="submitted && (latitude === null || longitude === null)" class="validation">Location is
                        required â€” please tap "Get My Location" to capture coordinates before submitting.</div>

                    <ion-item class="feature-item">
                        <ion-label>
                            <h2>Photo</h2>
                            <div class="photo-preview">
                                <div *ngIf="photoPreview"><img [src]="photoPreview" alt="Photo preview"
                                        style="max-width:120px; max-height:120px;" /></div>
                                <p *ngIf="!photoPreview" class="ion-text-wrap">No photo taken - tap button to capture an
                                    image</p>
                            </div>
                        </ion-label>
                        <ion-button slot="end" (click)="takePicture()" [disabled]="uploadingPhoto"
                            class="camera-button">
                            <ion-spinner *ngIf="uploadingPhoto" name="dots" slot="start"></ion-spinner>
                            <ion-icon *ngIf="!uploadingPhoto" name="camera-outline" slot="start"></ion-icon>
                            <span *ngIf="!uploadingPhoto">Take Photo</span>
                        </ion-button>
                    </ion-item>

                    <ion-button type="submit" expand="block" class="gradient-button ion-margin-top"
                        [disabled]="submitting">
                        <ion-spinner *ngIf="submitting" name="dots" slot="start"></ion-spinner>
                        <ion-icon *ngIf="!submitting" name="paper-plane-outline" slot="start"></ion-icon>
                        <span *ngIf="!submitting">Submit Survey</span>
                        <span *ngIf="submitting">Submitting...</span>
                    </ion-button>

                    <div class="ion-text-center ion-margin-top register-link-container">
                        <a (click)="goBack()" class="register-pill">
                            <ion-icon name="arrow-back-outline"></ion-icon>
                            <span>Back to Dashboard</span>
                        </a>
                    </div>
                </form>
            </ion-card-content>
        </ion-card>
    </div>
</ion-content>